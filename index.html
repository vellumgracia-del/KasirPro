<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Pengusaha v5</title>
    <!-- Menggunakan Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Menggunakan Font Inter dari Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icon untuk tab browser -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’¹</text></svg>">
    <style>
        /* Style kustom tambahan */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f7f7f7; /* Mengunci latar belakang ke warna netral */
        }
        .calculator-card {
            display: none;
        }
        .calculator-card.active {
            display: block;
        }
        /* Style untuk scrollbar agar lebih modern */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #a0a0a0;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #888;
        }
        /* Animasi */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse-float {
            animation: pulseFloat 4s ease-in-out infinite;
        }
        @keyframes pulseFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.03); }
        }
        /* Transisi untuk sidebar */
        #sidebar {
            transition: transform 0.3s ease-in-out;
        }
        /* Style untuk menu accordion */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .accordion-header.active + .accordion-content {
            max-height: 500px; /* Sesuaikan jika item lebih banyak */
        }
        .accordion-header .chevron {
            transition: transform 0.3s ease-in-out;
        }
        .accordion-header.active .chevron {
            transform: rotate(90deg);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Landing Screen -->
    <div id="landing-screen" class="fixed inset-0 bg-gray-900 flex flex-col items-center justify-center z-50 transition-opacity duration-500">
        <div class="text-center p-4">
            <!-- Logo Anda -->
            <svg class="mx-auto h-20 w-auto text-teal-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 15.75V18m-7.5-6.75h.008v.008H8.25v-.008Zm0 3h.008v.008H8.25v-.008Zm0 3h.008v.008H8.25v-.008Zm3.75 0h.008v.008h-.008v-.008Zm0-3h.008v.008h-.008v-.008Zm0-3h.008v.008h-.008v-.008Zm3.75 0h.008v.008h-.008v-.008Zm0 3h.008v.008h-.008v-.008Zm0 3h.008v.008h-.008v-.008Zm-7.5-6.75h.008v.008H8.25v-.008Zm.75 0h.008v.008h-.008v-.008Zm.75 0h.008v.008h-.008v-.008Zm.75 0h.008v.008h-.008v-.008Zm.75 0h.008v.008h-.008v-.008Zm.75 0h.008v.008h-.008v-.008Z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h15.75c.621 0 1.125.504 1.125 1.125v6.75C21 20.496 20.496 21 19.875 21H4.125A1.125 1.125 0 0 1 3 19.875v-6.75ZM19.5 3.75h.008v.008h-.008v-.008Z" />
            </svg>
            <h1 class="mt-6 text-4xl font-bold tracking-tight text-white sm:text-5xl">Kalkulator Pengusaha</h1>
            <p class="mt-4 text-lg text-gray-300">Solusi lengkap perhitungan bisnis Anda, kini lebih powerful.</p>
            <button id="enter-app-btn" class="mt-8 rounded-md bg-teal-600 px-4 py-2.5 text-sm font-semibold text-white shadow-lg hover:bg-teal-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-teal-600 transition-transform transform hover:scale-105">
                Masuk ke Aplikasi
            </button>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="main-app" class="hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 bg-gray-800 text-white flex flex-col p-4 border-r border-gray-700 w-72 transform -translate-x-full z-40 overflow-y-auto">
            <div class="flex items-center justify-between gap-3 mb-6 px-2">
                <h2 class="text-xl font-bold">Menu Kalkulator</h2>
                <button id="close-menu-btn" class="p-1 rounded-full hover:bg-gray-700 lg:hidden">
                     <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <nav id="sidebar-nav" class="flex flex-col gap-1">
                <!-- Kategori akan dimasukkan oleh JavaScript -->
            </nav>
            <div class="mt-auto pt-4 border-t border-gray-600">
                <a href="#" class="nav-item flex items-center gap-3 w-full text-left p-2 rounded-lg hover:bg-gray-700 transition-colors" data-calculator="history">
                    <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>
                    Riwayat Perhitungan
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="transition-all duration-300 ease-in-out">
            <header class="sticky top-0 bg-teal-600 text-white shadow-lg z-20">
                <div class="flex items-center p-4">
                    <button id="open-menu-btn" class="p-2 mr-4 rounded-md hover:bg-teal-700">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>
                    </button>
                    <h1 class="text-xl font-semibold">Dashboard</h1>
                </div>
            </header>
            <div class="p-6 md:p-8">
                <div id="calculator-content" class="max-w-4xl mx-auto">
                     <div id="welcome-screen" class="calculator-card active">
                        <div class="bg-white p-8 rounded-xl shadow-2xl overflow-hidden border border-gray-100">
                            <h1 class="text-4xl font-extrabold text-gray-900 text-center tracking-tight">Kalkulator Bisnis Premium</h1>
                            <p class="mt-4 text-xl text-gray-500 text-center font-light">Akses cepat ke lebih dari 20 alat hitung finansial dan operasional penting.</p>

                            <!-- NEW: Enhanced Summary Cards Grid -->
                            <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
                                
                                <!-- Card 1: Keuangan & Akuntansi -->
                                <div class="group p-6 bg-blue-50 border border-blue-200 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer nav-item" data-calculator="HPP">
                                    <div class="flex items-center gap-4">
                                        <div class="p-3 bg-blue-500 rounded-full text-white group-hover:bg-blue-600 transition-colors">
                                            <svg class="h-7 w-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.076 60.076 0 011.5-6v2.406a4.5 4.5 0 01-3.75-4.383V18.75zm12.75-9.75h.008v.008h-.008V9zm4.5 0h.008v.008h-.008V9zm-2.25 0h.008v.008h-.008V9zm-4.5 0h.008v.008h-.008V9zm-4.5 0h.008v.008h-.008V9zm-2.25 0h.008v.008h-.008V9z" /></svg>
                                        </div>
                                        <h3 class="text-xl font-bold text-blue-800 group-hover:text-blue-900">Fondasi Keuangan</h3>
                                    </div>
                                    <p class="mt-4 text-gray-600 text-sm">Hitung HPP, Laba Bersih, BEP, dan susun laporan arus kas. Klik untuk menuju Kalkulator HPP.</p>
                                    <span class="mt-3 block text-blue-600 font-medium text-sm group-hover:text-blue-800 transition-colors">Akses Cepat &rarr;</span>
                                </div>
                                
                                <!-- Card 2: Investasi & Pembiayaan -->
                                <div class="group p-6 bg-amber-50 border border-amber-200 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer nav-item" data-calculator="NPV">
                                    <div class="flex items-center gap-4">
                                        <div class="p-3 bg-amber-500 rounded-full text-white group-hover:bg-amber-600 transition-colors">
                                            <svg class="h-7 w-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12M12 6a2.25 2.25 0 00-2.25 2.25V18m0 0v-3.75m0-4.5a2.25 2.25 0 012.25-2.25h2.25a2.25 2.25 0 012.25 2.25v3.75m0 0h3.75M12 6a2.25 2.25 0 012.25 2.25v3.75m0 0v3.75m0 0H7.5" /></svg>
                                        </div>
                                        <h3 class="text-xl font-bold text-amber-800 group-hover:text-amber-900">Analisis Investasi</h3>
                                    </div>
                                    <p class="mt-4 text-gray-600 text-sm">Hitung NPV, IRR, ROI, dan Cicilan Anuitas untuk proyek atau pinjaman modal baru. Klik untuk menuju Kalkulator NPV.</p>
                                    <span class="mt-3 block text-amber-600 font-medium text-sm group-hover:text-amber-800 transition-colors">Akses Cepat &rarr;</span>
                                </div>
                                
                                <!-- Card 3: Efisiensi & Operasional -->
                                <div class="group p-6 bg-green-50 border border-green-200 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer nav-item" data-calculator="ROI">
                                    <div class="flex items-center gap-4">
                                        <div class="p-3 bg-green-500 rounded-full text-white group-hover:bg-green-600 transition-colors">
                                            <svg class="h-7 w-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-10.5m-5.25 15l-4.5-4.5m10.5-10.5m4.5 4.5" /></svg>
                                        </div>
                                        <h3 class="text-xl font-bold text-green-800 group-hover:text-green-900">Rasio & Efisiensi</h3>
                                    </div>
                                    <p class="mt-4 text-gray-600 text-sm">Ukur performa bisnis Anda: hitung Margin Laba, Current Ratio, dan Inventory Turnover. Klik untuk menuju Kalkulator ROI.</p>
                                    <span class="mt-3 block text-green-600 font-medium text-sm group-hover:text-green-800 transition-colors">Akses Cepat &rarr;</span>
                                </div>
                            </div>
                            <!-- END NEW: Summary Cards Grid -->

                            <!-- Footer/Settings Section -->
                            <div class="mt-12 pt-6 border-t border-gray-100 flex flex-col sm:flex-row items-center justify-between">
                                <p class="text-sm text-gray-500 mb-4 sm:mb-0">Didesain untuk mempermudah pengambilan keputusan cepat dan akurat.</p>
                                <button id="clear-history-homepage-btn" class="text-sm text-red-600 hover:text-red-700 font-medium transition-colors">
                                    Bersihkan Semua Riwayat
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Overlay for mobile menu -->
        <div id="menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden"></div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', function () {
    // DOM Elements
    const landingScreen = document.getElementById('landing-screen');
    const enterAppBtn = document.getElementById('enter-app-btn');
    const mainApp = document.getElementById('main-app');
    const sidebar = document.getElementById('sidebar');
    const sidebarNav = document.getElementById('sidebar-nav');
    const calculatorContent = document.getElementById('calculator-content');
    const openMenuBtn = document.getElementById('open-menu-btn');
    const closeMenuBtn = document.getElementById('close-menu-btn');
    const menuOverlay = document.getElementById('menu-overlay');
    const mainContent = document.getElementById('main-content');
    const headerTitle = document.querySelector('#main-content header h1');

    let history = [];
    const HISTORY_KEY = 'entrepreneurCalcHistory';

    // Data untuk semua kalkulator dan kategorinya (tetap sama dengan sebelumnya)
    const categories = {
        "Dasar Keuangan & Akuntansi": {
            "HPP": {
                title: "Harga Pokok Penjualan (HPP)",
                description: "Hitung biaya langsung yang timbul dari produksi barang atau jasa.",
                inputs: [
                    { id: "hpp-persediaan-awal", label: "Persediaan Awal", type: "number" },
                    { id: "hpp-pembelian-bersih", label: "Pembelian Bersih", type: "number" },
                    { id: "hpp-persediaan-akhir", label: "Persediaan Akhir", type: "number" },
                ],
                calculation: (v) => v['hpp-persediaan-awal'] + v['hpp-pembelian-bersih'] - v['hpp-persediaan-akhir'],
                resultLabel: "Harga Pokok Penjualan (HPP)"
            },
            "BEP": {
                title: "Break Even Point (BEP)",
                description: "Tentukan titik di mana total pendapatan sama dengan total biaya.",
                inputs: [
                    { id: "bep-biaya-tetap", label: "Total Biaya Tetap", type: "number" },
                    { id: "bep-harga-jual", label: "Harga Jual per Unit", type: "number" },
                    { id: "bep-biaya-variabel", label: "Biaya Variabel per Unit", type: "number" },
                ],
                calculation: (v) => {
                    const denominator = v['bep-harga-jual'] - v['bep-biaya-variabel'];
                    if (denominator <= 0) return { error: "Harga jual harus lebih besar dari biaya variabel." };
                    const bepUnit = v['bep-biaya-tetap'] / denominator;
                    const bepPrice = bepUnit * v['bep-harga-jual'];
                    return `BEP Unit: ${Math.ceil(bepUnit).toLocaleString('id-ID')} unit<br>BEP Rupiah: ${formatCurrency(bepPrice)}`;
                },
                resultLabel: "Hasil Titik Impas (BEP)"
            },
            "LabaKotor": {
                title: "Laba Kotor",
                description: "Hitung selisih antara pendapatan dari penjualan dengan harga pokok penjualan.",
                inputs: [
                    { id: "lk-penjualan", label: "Total Penjualan (Pendapatan)", type: "number" },
                    { id: "lk-hpp", label: "Harga Pokok Penjualan (HPP)", type: "number" },
                ],
                calculation: (v) => v['lk-penjualan'] - v['lk-hpp'],
                resultLabel: "Laba Kotor"
            },
            "LabaBersih": {
                title: "Laba Bersih",
                description: "Hitung laba yang tersisa setelah dikurangi semua beban, termasuk pajak.",
                inputs: [
                    { id: "lb-laba-kotor", label: "Laba Kotor", type: "number" },
                    { id: "lb-beban-ops", label: "Beban Operasional", type: "number" },
                    { id: "lb-pajak", label: "Pajak", type: "number" },
                ],
                calculation: (v) => v['lb-laba-kotor'] - v['lb-beban-ops'] - v['lb-pajak'],
                resultLabel: "Laba Bersih"
            },
            "ArusKas": {
                title: "Arus Kas (Cash Flow)",
                description: "Hitung selisih antara total kas yang masuk dengan total kas yang keluar.",
                inputs: [
                    { id: "ak-kas-masuk", label: "Total Kas Masuk", type: "number" },
                    { id: "ak-kas-keluar", label: "Total Kas Keluar", type: "number" },
                ],
                calculation: (v) => v['ak-kas-masuk'] - v['ak-kas-keluar'],
                resultLabel: "Arus Kas Bersih"
            },
            "Depresiasi": {
                title: "Depresiasi (Metode Garis Lurus)",
                description: "Hitung penyusutan nilai aset tetap selama umur ekonomisnya.",
                inputs: [
                    { id: "d-harga-perolehan", label: "Harga Perolehan Aset", type: "number" },
                    { id: "d-nilai-sisa", label: "Nilai Sisa (Residu)", type: "number" },
                    { id: "d-umur-ekonomis", label: "Umur Ekonomis (Tahun)", type: "number" },
                ],
                calculation: (v) => {
                    if (v['d-umur-ekonomis'] === 0) return { error: "Umur ekonomis tidak boleh nol." };
                    const depr = (v['d-harga-perolehan'] - v['d-nilai-sisa']) / v['d-umur-ekonomis'];
                    return `${formatCurrency(depr)} / tahun`;
                },
                resultLabel: "Beban Depresiasi Tahunan"
            }
        },
        "Pembiayaan, Kredit & Investasi": {
            "Anuitas": {
                title: "Anuitas (Cicilan Pinjaman)",
                description: "Hitung jumlah cicilan tetap per periode untuk pinjaman.",
                inputs: [
                    { id: "an-pokok", label: "Jumlah Pokok Pinjaman", type: "number" },
                    { id: "an-bunga", label: "Suku Bunga per Tahun (%)", type: "number" },
                    { id: "an-periode", label: "Jangka Waktu (Bulan)", type: "number" },
                ],
                calculation: (v) => {
                    if (v['an-periode'] === 0) return { error: "Periode tidak boleh nol." };
                    const r = (v['an-bunga'] / 100) / 12; // Bunga bulanan
                    if (r === 0) return v['an-pokok'] / v['an-periode'];
                    const anuitas = v['an-pokok'] * (r * Math.pow(1 + r, v['an-periode'])) / (Math.pow(1 + r, v['an-periode']) - 1);
                    return `${formatCurrency(anuitas)} / bulan`;
                },
                resultLabel: "Cicilan per Bulan"
            },
            "BungaTunggal": {
                title: "Bunga Tunggal",
                description: "Hitung bunga yang didapat dari modal pokok saja.",
                inputs: [
                    { id: "bt-pokok", label: "Modal Pokok", type: "number" },
                    { id: "bt-bunga", label: "Suku Bunga per Tahun (%)", type: "number" },
                    { id: "bt-waktu", label: "Jangka Waktu (Tahun)", type: "number" },
                ],
                calculation: (v) => v['bt-pokok'] * (v['bt-bunga'] / 100) * v['bt-waktu'],
                resultLabel: "Total Bunga Tunggal"
            },
            "BungaMajemuk": {
                title: "Bunga Majemuk",
                description: "Hitung total akumulasi modal beserta bunganya dari waktu ke waktu.",
                inputs: [
                    { id: "bm-pokok", label: "Modal Awal (Pokok)", type: "number" },
                    { id: "bm-bunga", label: "Suku Bunga per Periode (%)", type: "number" },
                    { id: "bm-periode", label: "Jumlah Periode", type: "number" },
                ],
                calculation: (v) => {
                    const r = v['bm-bunga'] / 100;
                    const total = v['bm-pokok'] * Math.pow((1 + r), v['bm-periode']);
                    const interest = total - v['bm-pokok'];
                    return `Total Akhir: ${formatCurrency(total)}<br>Total Bunga: ${formatCurrency(interest)}`;
                },
                resultLabel: "Hasil Bunga Majemuk"
            },
            "NPV": {
                title: "Net Present Value (NPV)",
                description: "Hitung nilai sekarang dari arus kas masa depan untuk mengevaluasi kelayakan investasi.",
                inputs: [
                    { id: "npv-investasi", label: "Investasi Awal", type: "number" },
                    { id: "npv-diskon", label: "Tingkat Diskonto (%)", type: "number" },
                    { id: "npv-cf1", label: "Arus Kas Tahun 1", type: "number" },
                    { id: "npv-cf2", label: "Arus Kas Tahun 2", type: "number" },
                    { id: "npv-cf3", label: "Arus Kas Tahun 3", type: "number" },
                    { id: "npv-cf4", label: "Arus Kas Tahun 4", type: "number" },
                    { id: "npv-cf5", label: "Arus Kas Tahun 5", type: "number" },
                ],
                calculation: (v) => {
                    const r = v['npv-diskon'] / 100;
                    let pv = 0;
                    for (let t = 1; t <= 5; t++) {
                        const cf = v[`npv-cf${t}`] || 0;
                        pv += cf / Math.pow(1 + r, t);
                    }
                    const npv = pv - v['npv-investasi'];
                    const status = npv >= 0 ? '<span class="text-green-600">(Layak)</span>' : '<span class="text-red-600">(Tidak Layak)</span>';
                    return `${formatCurrency(npv)} ${status}`;
                },
                resultLabel: "Net Present Value (NPV)"
            },
            "IRR": {
                title: "Internal Rate of Return (IRR)",
                description: "Hitung tingkat pengembalian internal dari suatu investasi. (Perkiraan)",
                inputs: [
                    { id: "irr-investasi", label: "Investasi Awal", type: "number" },
                    { id: "irr-cf1", label: "Arus Kas Tahun 1", type: "number" },
                    { id: "irr-cf2", label: "Arus Kas Tahun 2", type: "number" },
                    { id: "irr-cf3", label: "Arus Kas Tahun 3", type: "number" },
                    { id: "irr-cf4", label: "Arus Kas Tahun 4", type: "number" },
                    { id: "irr-cf5", label: "Arus Kas Tahun 5", type: "number" },
                ],
                calculation: (v) => {
                    const cfs = [-v['irr-investasi']];
                    for (let i = 1; i <= 5; i++) cfs.push(v[`irr-cf${i}`] || 0);
                    const calculateNPV = (rate) => cfs.reduce((acc, val, i) => acc + val / Math.pow(1 + rate, i), 0);
                    let irr = 0.1, delta = 0.05;
                    for (let i = 0; i < 100; i++) {
                        let npv = calculateNPV(irr);
                        if (Math.abs(npv) < 1e-5) break;
                        irr += npv > 0 ? delta : -delta;
                        delta /= 2;
                    }
                    return (irr > -1 && irr < 5) ? `${(irr * 100).toFixed(2)} %` : "Tidak dapat dihitung (arus kas tidak biasa).";
                },
                resultLabel: "Internal Rate of Return (IRR)"
            },
            "ROI": {
                title: "Return on Investment (ROI)",
                description: "Ukur efisiensi atau profitabilitas investasi.",
                inputs: [ { id: "roi-laba", label: "Laba Bersih dari Investasi", type: "number" }, { id: "roi-investasi", label: "Biaya Investasi", type: "number" } ],
                calculation: (v) => (v['roi-investasi'] === 0) ? { error: "Biaya investasi tidak boleh nol." } : `${((v['roi-laba'] / v['roi-investasi']) * 100).toFixed(2)} %`,
                resultLabel: "Return on Investment (ROI)"
            },
            "ROE": {
                title: "Return on Equity (ROE)",
                description: "Ukur kemampuan perusahaan menghasilkan laba dari modal sendiri.",
                inputs: [ { id: "roe-laba", label: "Laba Bersih Setelah Pajak", type: "number" }, { id: "roe-modal", label: "Total Modal Sendiri (Ekuitas)", type: "number" } ],
                calculation: (v) => (v['roe-modal'] === 0) ? { error: "Modal tidak boleh nol." } : `${((v['roe-laba'] / v['roe-modal']) * 100).toFixed(2)} %`,
                resultLabel: "Return on Equity (ROE)"
            },
            "ROA": {
                title: "Return on Assets (ROA)",
                description: "Ukur kemampuan perusahaan menghasilkan laba dari total asetnya.",
                inputs: [ { id: "roa-laba", label: "Laba Bersih Setelah Pajak", type: "number" }, { id: "roa-aset", label: "Total Aset", type: "number" } ],
                calculation: (v) => (v['roa-aset'] === 0) ? { error: "Aset tidak boleh nol." } : `${((v['roa-laba'] / v['roa-aset']) * 100).toFixed(2)} %`,
                resultLabel: "Return on Assets (ROA)"
            },
            "PaybackPeriod": {
                title: "Payback Period",
                description: "Hitung waktu yang dibutuhkan untuk mengembalikan modal investasi awal.",
                inputs: [ { id: "pp-investasi", label: "Investasi Awal", type: "number" }, { id: "pp-kas-tahunan", label: "Arus Kas Masuk Tahunan", type: "number" } ],
                calculation: (v) => (v['pp-kas-tahunan'] <= 0) ? { error: "Arus kas tahunan harus positif." } : `${(v['pp-investasi'] / v['pp-kas-tahunan']).toFixed(2)} tahun`,
                resultLabel: "Periode Pengembalian"
            },
            "EBITDA": {
                title: "EBITDA",
                description: "Laba sebelum Bunga, Pajak, Depresiasi, dan Amortisasi.",
                 inputs: [ { id: "ebitda-laba-bersih", label: "Laba Bersih", type: "number" }, { id: "ebitda-pajak", label: "Beban Pajak", type: "number" }, { id: "ebitda-bunga", label: "Beban Bunga", type: "number" }, { id: "ebitda-depresiasi", label: "Depresiasi", type: "number" }, { id: "ebitda-amortisasi", label: "Amortisasi", type: "number" } ],
                calculation: (v) => v['ebitda-laba-bersih'] + v['ebitda-pajak'] + v['ebitda-bunga'] + v['ebitda-depresiasi'] + v['ebitda-amortisasi'],
                resultLabel: "EBITDA"
            }
        },
        "Biaya Produksi & Operasional": {
            "BiayaTotal": {
                title: "Biaya Total",
                description: "Hitung jumlah keseluruhan dari biaya tetap dan biaya variabel.",
                inputs: [ { id: "bt-tetap", label: "Total Biaya Tetap", type: "number" }, { id: "bt-variabel", label: "Total Biaya Variabel", type: "number" } ],
                calculation: (v) => v['bt-tetap'] + v['bt-variabel'],
                resultLabel: "Biaya Total"
            },
            "EfisiensiProduksi": {
                title: "Efisiensi Produksi",
                description: "Ukur perbandingan antara output aktual dengan output standar.",
                inputs: [ { id: "ep-aktual", label: "Output Aktual (unit)", type: "number" }, { id: "ep-standar", label: "Output Standar (unit)", type: "number" } ],
                calculation: (v) => (v['ep-standar'] === 0) ? { error: "Output standar tidak boleh nol." } : `${((v['ep-aktual'] / v['ep-standar']) * 100).toFixed(2)} %`,
                resultLabel: "Tingkat Efisiensi"
            },
            "Produktivitas": {
                title: "Produktivitas",
                description: "Ukur rasio antara output yang dihasilkan dengan input yang digunakan.",
                inputs: [ { id: "p-output", label: "Jumlah Output (misal: unit)", type: "number" }, { id: "p-input", label: "Jumlah Input (misal: jam kerja)", type: "number" } ],
                calculation: (v) => (v['p-input'] === 0) ? { error: "Input tidak boleh nol." } : `${(v['p-output'] / v['p-input']).toFixed(2)} unit per input`,
                resultLabel: "Tingkat Produktivitas"
            }
        },
        "Analisis Bisnis": {
            "MarginLaba": {
                title: "Margin Laba",
                description: "Hitung persentase keuntungan dari total pendapatan.",
                inputs: [ { id: "ml-laba", label: "Laba Bersih", type: "number" }, { id: "ml-penjualan", label: "Total Penjualan", type: "number" } ],
                calculation: (v) => (v['ml-penjualan'] === 0) ? { error: "Penjualan tidak boleh nol." } : `${((v['ml-laba'] / v['ml-penjualan']) * 100).toFixed(2)} %`,
                resultLabel: "Margin Laba"
            },
            "Markup": {
                title: "Markup",
                description: "Hitung persentase kenaikan harga dari HPP ke harga jual.",
                inputs: [ { id: "m-harga-jual", label: "Harga Jual", type: "number" }, { id: "m-hpp", label: "Harga Pokok Penjualan (HPP)", type: "number" } ],
                calculation: (v) => (v['m-hpp'] === 0) ? { error: "HPP tidak boleh nol." } : `${(((v['m-harga-jual'] - v['m-hpp']) / v['m-hpp']) * 100).toFixed(2)} %`,
                resultLabel: "Persentase Markup"
            },
            "CashRatio": {
                title: "Cash Ratio (Rasio Kas)",
                description: "Ukur kemampuan perusahaan membayar utang jangka pendek dengan kas.",
                inputs: [ { id: "cr-kas", label: "Total Kas & Setara Kas", type: "number" }, { id: "cr-utang-lancar", label: "Total Kewajiban Lancar", type: "number" } ],
                calculation: (v) => (v['cr-utang-lancar'] === 0) ? { error: "Kewajiban lancar tidak boleh nol." } : `${(v['cr-kas'] / v['cr-utang-lancar']).toFixed(2)}`,
                resultLabel: "Cash Ratio"
            },
            "CurrentRatio": {
                title: "Current Ratio (Rasio Lancar)",
                description: "Ukur kemampuan perusahaan membayar utang jangka pendek dengan aset lancar.",
                inputs: [ { id: "curr-aset-lancar", label: "Total Aset Lancar", type: "number" }, { id: "curr-utang-lancar", label: "Total Kewajiban Lancar", type: "number" } ],
                calculation: (v) => (v['curr-utang-lancar'] === 0) ? { error: "Kewajiban lancar tidak boleh nol." } : `${(v['curr-aset-lancar'] / v['curr-utang-lancar']).toFixed(2)}`,
                resultLabel: "Current Ratio"
            },
            "DER": {
                title: "Debt to Equity Ratio (DER)",
                description: "Bandingkan total utang perusahaan dengan modal sendiri.",
                inputs: [ { id: "der-utang", label: "Total Utang", type: "number" }, { id: "der-modal", label: "Total Modal (Ekuitas)", type: "number" } ],
                calculation: (v) => (v['der-modal'] === 0) ? { error: "Modal tidak boleh nol." } : `${(v['der-utang'] / v['der-modal']).toFixed(2)}`,
                resultLabel: "Debt to Equity Ratio"
            },
            "InventoryTurnover": {
                title: "Inventory Turnover",
                description: "Ukur seberapa sering persediaan terjual dalam satu periode.",
                inputs: [ { id: "it-hpp", label: "Harga Pokok Penjualan (HPP)", type: "number" }, { id: "it-persediaan", label: "Rata-rata Persediaan", type: "number" } ],
                calculation: (v) => (v['it-persediaan'] === 0) ? { error: "Persediaan tidak boleh nol." } : `${(v['it-hpp'] / v['it-persediaan']).toFixed(2)} kali`,
                resultLabel: "Inventory Turnover Ratio"
            },
            "WorkingCapital": {
                title: "Working Capital (Modal Kerja)",
                description: "Hitung selisih antara aset lancar dengan kewajiban lancar.",
                inputs: [ { id: "wc-aset-lancar", label: "Total Aset Lancar", type: "number" }, { id: "wc-utang-lancar", label: "Total Kewajiban Lancar", type: "number" } ],
                calculation: (v) => v['wc-aset-lancar'] - v['wc-utang-lancar'],
                resultLabel: "Modal Kerja Bersih"
            }
        },
        "Penganggaran & Perencanaan": {
            "VarianceAnalysis": {
                title: "Analisis Varians",
                description: "Bandingkan hasil aktual dengan angka yang dianggarkan.",
                inputs: [ { id: "va-aktual", label: "Hasil Aktual (Realisasi)", type: "number" }, { id: "va-anggaran", label: "Angka Anggaran", type: "number" } ],
                calculation: (v) => {
                    const variance = v['va-aktual'] - v['va-anggaran'];
                    const status = variance >= 0 ? '<span class="text-green-600">(Favorable)</span>' : '<span class="text-red-600">(Unfavorable)</span>';
                    return `${formatCurrency(variance)} ${status}`;
                },
                resultLabel: "Hasil Analisis Varians"
            },
            "CapEx": {
                title: "Capital Expenditure (CapEx)",
                description: "Total biaya untuk memperoleh atau meningkatkan aset tetap.",
                inputs: [ { id: "capex-total", label: "Total Pengeluaran Modal", type: "number" } ],
                calculation: (v) => v['capex-total'],
                resultLabel: "Total CapEx"
            },
            "OpEx": {
                title: "Operational Expenditure (OpEx)",
                description: "Total biaya operasional rutin untuk menjalankan bisnis.",
                inputs: [ { id: "opex-total", label: "Total Pengeluaran Operasional", type: "number" } ],
                calculation: (v) => v['opex-total'],
                resultLabel: "Total OpEx"
            },
        },
        "Pajak & Regulasi": {
            "PPh": {
                title: "Pajak Penghasilan (PPh)",
                description: "Hitung estimasi PPh berdasarkan tarif yang berlaku.",
                 inputs: [ { id: "pph-pkp", label: "Penghasilan Kena Pajak (PKP)", type: "number" }, { id: "pph-tarif", label: "Tarif Pajak (%)", type: "number" } ],
                calculation: (v) => v['pph-pkp'] * (v['pph-tarif'] / 100),
                resultLabel: "Jumlah PPh Terutang"
            },
            "PPN": {
                title: "Pajak Pertambahan Nilai (PPN)",
                description: "Hitung PPN yang dikenakan atas transaksi barang atau jasa.",
                inputs: [ { id: "ppn-dpp", label: "Dasar Pengenaan Pajak (DPP)", type: "number" }, { id: "ppn-tarif", label: "Tarif PPN (%)", type: "number", value: 11 } ],
                calculation: (v) => (v['ppn-dpp'] * v['ppn-tarif']) / 100,
                resultLabel: "Jumlah PPN"
            },
            "PBB": {
                title: "Pajak Bumi & Bangunan (PBB)",
                description: "Hitung PBB berdasarkan Nilai Jual Objek Pajak (NJOP).",
                inputs: [ { id: "pbb-njop", label: "NJOP", type: "number" }, { id: "pbb-tarif", label: "Tarif PBB Efektif (%)", type: "number", value: 0.1 } ],
                calculation: (v) => v['pbb-njop'] * (v['pbb-tarif'] / 100),
                resultLabel: "Jumlah PBB Terutang"
            }
        }
    };

    // --- Fungsi Utilitas & Manajemen State ---
    const formatCurrency = (value) => (typeof value !== 'number') ? value : `Rp ${value.toLocaleString('id-ID', { minimumFractionDigits: 0, maximumFractionDigits: 2 })}`;
    const saveHistory = () => localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
    const loadHistory = () => history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
    
    // --- Fungsi UI ---
    const openMenu = () => {
        sidebar.classList.remove('-translate-x-full');
        menuOverlay.classList.remove('hidden');
        mainContent.classList.add('lg:ml-72');
    };

    const closeMenu = () => {
        sidebar.classList.add('-translate-x-full');
        menuOverlay.classList.add('hidden');
        mainContent.classList.remove('lg:ml-72');
    };
    
    // Fungsi changeTheme dan loadDashboardImage (dihapus/dinonaktifkan)
    
    const initializeUI = () => {
        // Buat Navigasi Sidebar
        const dashboardLink = document.createElement('a');
        dashboardLink.href = '#';
        dashboardLink.className = 'nav-item flex items-center gap-3 w-full text-left p-2 rounded-lg hover:bg-gray-700 transition-colors mb-2';
        dashboardLink.dataset.calculator = 'dashboard';
        dashboardLink.innerHTML = `<svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" /></svg>Dashboard`;
        sidebarNav.appendChild(dashboardLink);

        Object.entries(categories).forEach(([categoryName, calculators]) => {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = "py-1";
            const header = document.createElement('button');
            header.className = 'accordion-header w-full flex justify-between items-center p-2 rounded-lg hover:bg-gray-700 transition-colors';
            header.innerHTML = `
                <span class="font-semibold text-sm text-left">${categoryName}</span>
                <svg class="chevron h-4 w-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg>
            `;
            const content = document.createElement('div');
            content.className = 'accordion-content pl-4 pt-1';
            Object.keys(calculators).forEach(calcKey => {
                const navItem = document.createElement('a');
                navItem.href = '#';
                navItem.className = 'nav-item block w-full text-left p-2 text-sm rounded-lg hover:bg-gray-700 transition-colors';
                navItem.textContent = calculators[calcKey].title;
                navItem.dataset.calculator = calcKey;
                content.appendChild(navItem);
            });
            categoryDiv.appendChild(header);
            categoryDiv.appendChild(content);
            sidebarNav.appendChild(categoryDiv);
        });

        // Buat Kartu Kalkulator
        Object.values(categories).flatMap(Object.entries).forEach(([calcKey, details]) => {
            const card = document.createElement('div');
            card.id = `calc-${calcKey}`;
            card.className = 'calculator-card';
            let inputsHTML = details.inputs.map(input => `
                <div class="mb-4">
                    <label for="${input.id}" class="block text-sm font-medium text-gray-700 mb-1">${input.label}</label>
                    <input type="${input.type}" id="${input.id}" name="${input.id}" ${input.value ? `value="${input.value}"` : ''} step="any" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2 bg-gray-50" placeholder="0">
                </div>
            `).join('');

            card.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-md fade-in">
                    <h2 class="text-2xl font-bold text-gray-900">${details.title}</h2>
                    <p class="mt-2 text-gray-600">${details.description}</p>
                    <form id="form-${calcKey}" class="mt-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6">${inputsHTML}</div>
                        <div class="flex gap-4 mt-6">
                            <button type="submit" class="flex-1 rounded-md bg-teal-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-teal-500">Hitung</button>
                            <button type="reset" class="flex-1 rounded-md bg-gray-200 px-3 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-300">Reset</button>
                        </div>
                    </form>
                    <div id="result-${calcKey}" class="mt-6 p-4 bg-teal-50 rounded-lg border border-teal-200 hidden">
                        <h3 class="text-md font-semibold text-teal-800">${details.resultLabel}</h3>
                        <p class="text-2xl font-bold text-teal-900 mt-1"></p>
                    </div>
                    <button id="save-history-${calcKey}" class="mt-4 w-full rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 hidden">Simpan ke Riwayat</button>
                </div>`;
            calculatorContent.appendChild(card);
        });
        
        // Buat Halaman Riwayat
        const historyCard = document.createElement('div');
        historyCard.id = 'calc-history';
        historyCard.className = 'calculator-card';
        historyCard.innerHTML = `
             <div class="bg-white p-6 rounded-xl shadow-md fade-in">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">Riwayat Perhitungan</h2>
                    <button id="clear-history-btn" class="rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500">Bersihkan Riwayat</button>
                </div>
                <div id="history-list" class="mt-6 space-y-4"></div>
            </div>`;
        calculatorContent.appendChild(historyCard);
    };

    const addEventListeners = () => {
        // Menu
        openMenuBtn.addEventListener('click', openMenu);
        closeMenuBtn.addEventListener('click', closeMenu);
        menuOverlay.addEventListener('click', closeMenu);
        
        // Tombol Bersihkan Riwayat (di Homepage)
        document.getElementById('clear-history-homepage-btn').addEventListener('click', () => {
           // Ganti alert dengan confirm
           if(confirm('Anda yakin ingin menghapus semua riwayat? Tindakan ini tidak dapat dibatalkan.')) {
               history = [];
               saveHistory();
               alert('Riwayat berhasil dibersihkan!');
           }
        });

        // Navigasi & Accordion
        sidebar.addEventListener('click', (e) => {
            const accordionHeader = e.target.closest('.accordion-header');
            const navItem = e.target.closest('.nav-item');

            if (accordionHeader) {
                accordionHeader.classList.toggle('active');
            }
            
            if (navItem) {
                e.preventDefault();
                const calculatorId = navItem.dataset.calculator;
                
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('bg-teal-700', 'font-semibold'));
                document.querySelectorAll('.calculator-card').forEach(card => card.classList.remove('active'));
                
                // Tambahkan styling aktif hanya jika bukan card ringkasan di welcome-screen
                if (!navItem.closest('#welcome-screen')) {
                    navItem.classList.add('bg-teal-700', 'font-semibold');
                }
                
                const targetCard = document.getElementById(`calc-${calculatorId}`);

                if (calculatorId === 'dashboard') {
                    document.getElementById('welcome-screen').classList.add('active');
                    headerTitle.textContent = "Dashboard";
                } else if (targetCard) {
                    targetCard.classList.add('active');
                    // Tentukan judul header
                    let title = navItem.textContent.trim();
                    if (title.endsWith('â†’')) { // Jika diklik dari summary card
                        const calcDetails = categories[Object.keys(categories).find(cat => Object.keys(categories[cat]).includes(calculatorId))][calculatorId];
                        title = calcDetails.title;
                    } else if (calculatorId !== 'history') { // Jika diklik dari sidebar
                        const calcDetails = categories[Object.keys(categories).find(cat => Object.keys(categories[cat]).includes(calculatorId))][calculatorId];
                        title = calcDetails.title;
                    }
                    headerTitle.textContent = title;
                } else if (calculatorId === 'history') {
                    document.getElementById('calc-history').classList.add('active');
                    headerTitle.textContent = "Riwayat Perhitungan";
                    renderHistory();
                }

                if (window.innerWidth < 1024) closeMenu();
            }
        });
        
        // Form Kalkulator
        Object.values(categories).flatMap(Object.entries).forEach(([calcKey, details]) => {
            const form = document.getElementById(`form-${calcKey}`);
            const resultDiv = document.getElementById(`result-${calcKey}`);
            const saveBtn = document.getElementById(`save-history-${calcKey}`);

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const values = {};
                let isValid = true;
                details.inputs.forEach(input => {
                    const el = document.getElementById(input.id);
                    const val = parseFloat(el.value);
                    if(el.value === '' || isNaN(val)) {
                        el.classList.add('border-red-500', 'ring-1', 'ring-red-500'); isValid = false;
                    } else {
                        el.classList.remove('border-red-500', 'ring-1', 'ring-red-500');
                    }
                    values[input.id] = val;
                });
                
                if (!isValid) {
                    resultDiv.querySelector('p').innerHTML = `<span class="text-red-600">Harap isi semua input dengan angka valid.</span>`;
                    resultDiv.classList.remove('hidden');
                    saveBtn.classList.add('hidden');
                    return;
                }

                const result = details.calculation(values);
                resultDiv.classList.remove('hidden');

                if (typeof result === 'object' && result.error) {
                     resultDiv.querySelector('p').innerHTML = `<span class="text-red-600">${result.error}</span>`;
                     saveBtn.classList.add('hidden');
                } else {
                    const finalResult = typeof result === 'number' ? formatCurrency(result) : result;
                    resultDiv.querySelector('p').innerHTML = finalResult;
                    saveBtn.dataset.result = finalResult.replace(/<br>|<[^>]+>/g, ' | ');
                    saveBtn.classList.remove('hidden');
                }
                
                const inputData = {};
                details.inputs.forEach(input => {
                    inputData[input.label] = formatCurrency(parseFloat(document.getElementById(input.id).value));
                });
                saveBtn.dataset.inputs = JSON.stringify(inputData);
            });

            form.addEventListener('reset', () => {
                resultDiv.classList.add('hidden');
                saveBtn.classList.add('hidden');
                details.inputs.forEach(input => document.getElementById(input.id).classList.remove('border-red-500', 'ring-1', 'ring-red-500'));
            });
            
            saveBtn.addEventListener('click', function() {
                history.unshift({
                    name: details.title,
                    result: this.dataset.result,
                    inputs: JSON.parse(this.dataset.inputs),
                    timestamp: new Date().toLocaleString('id-ID', { dateStyle: 'short', timeStyle: 'short' })
                });
                saveHistory();
                this.textContent = 'Berhasil Disimpan!'; this.disabled = true;
                setTimeout(() => { this.textContent = 'Simpan ke Riwayat'; this.disabled = false; }, 2000);
            });
        });
        
        document.getElementById('clear-history-btn').addEventListener('click', () => {
           if(confirm('Anda yakin ingin menghapus semua riwayat? Tindakan ini tidak dapat dibatalkan.')) {
               history = [];
               saveHistory();
               renderHistory();
           }
        });
    };

    const renderHistory = () => {
        const historyList = document.getElementById('history-list');
        historyList.innerHTML = history.length === 0 
            ? '<p class="text-gray-500 text-center py-4">Belum ada riwayat perhitungan.</p>'
            : history.map(item => `
                <div class="p-4 border rounded-lg bg-gray-50/80 hover:bg-white transition-all">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-semibold text-gray-800">${item.name}</p>
                            <p class="text-lg font-bold text-teal-700 mt-1">${item.result}</p>
                            <details class="text-sm text-gray-600 mt-2">
                                <summary class="cursor-pointer select-none">Detail Input</summary>
                                <ul class="list-disc pl-5 mt-1">${Object.entries(item.inputs).map(([k, v]) => `<li>${k}: ${v}</li>`).join('')}</ul>
                            </details>
                        </div>
                        <p class="text-xs text-gray-400 flex-shrink-0 ml-4 text-right">${item.timestamp}</p>
                    </div>
                </div>
            `).join('');
    };

    // Inisialisasi Aplikasi
    enterAppBtn.addEventListener('click', () => {
        landingScreen.classList.add('opacity-0');
        setTimeout(() => {
            landingScreen.style.display = 'none';
            mainApp.classList.remove('hidden');
            mainApp.classList.add('fade-in');
            if (window.innerWidth >= 1024) openMenu();
        }, 500);
    });

    loadHistory();
    initializeUI();
    addEventListeners();
});
</script>
</body>
</html>
